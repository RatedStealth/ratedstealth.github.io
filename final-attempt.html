<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final OAuth Attempt</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        h1 { color: #00AA00; }
        button { padding: 12px 24px; background: #4CAF50; color: white; border: none; border-radius: 4px; 
                cursor: pointer; font-size: 16px; display: block; margin: 20px 0; }
        button:hover { background: #45a049; }
        .container { border: 1px solid #ddd; padding: 20px; border-radius: 5px; margin: 20px 0; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; }
        .important { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Kick OAuth - Final Attempt</h1>
    
    <div class="container">
        <h2>Minimal OAuth Test</h2>
        <p class="important">IMPORTANT: Make sure you are logged into Kick.com in this browser before trying this.</p>
        
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="tryAuth('https://ratedstealth.github.io/final-attempt.html')">
                Try with this page as redirect
            </button>
            
            <button onclick="tryAuth('https://ratedstealth.github.io')">
                Try with root domain
            </button>
        </div>
        
        <div id="result" style="margin-top: 20px;"></div>
    </div>
    
    <div class="container" id="responseSection">
        <h2>Response Data</h2>
        <div id="responseData">Checking for OAuth response...</div>
    </div>
    
    <div class="container">
        <h2>Try Alternative Approach</h2>
        <p>If you're still unable to get an authorization code, you may need to try a different approach:</p>
        <ol>
            <li>Contact Kick support about API access for non-partner accounts</li>
            <li>Use a public API scraping method instead of OAuth for basic presence detection</li>
            <li>Implement a workaround where streamers manually report their status</li>
        </ol>
        <p class="important">NOTE: Kick may restrict API access to partner accounts only, which would explain why OAuth authorization is failing.</p>
    </div>
    
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            // Check for OAuth response
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const error = urlParams.get('error');
            
            const responseDiv = document.getElementById('responseData');
            
            if (code) {
                // Success!
                responseDiv.innerHTML = `
                    <div style="padding: 15px; background-color: #e8f5e9; border-left: 4px solid green;">
                        <h3 style="color: green;">SUCCESS! Authorization Code Received</h3>
                        <p><strong>Code:</strong> ${code}</p>
                        <p><strong>State:</strong> ${state || 'None'}</p>
                        <p><strong>Time:</strong> ${new Date().toLocaleString()}</p>
                        <p>Copy this code and use it with the /manual-oauth command in Discord.</p>
                    </div>
                    <button onclick="copyToClipboard('${code}')">Copy Code to Clipboard</button>
                `;
            } else if (error) {
                // Error occurred
                responseDiv.innerHTML = `
                    <div style="padding: 15px; background-color: #ffebee; border-left: 4px solid red;">
                        <h3 style="color: red;">ERROR: ${error}</h3>
                        <p><strong>Error Description:</strong> ${urlParams.get('error_description') || 'No description provided'}</p>
                        <p><strong>Time:</strong> ${new Date().toLocaleString()}</p>
                    </div>
                `;
            } else {
                // No response yet
                responseDiv.innerHTML = `
                    <p>No OAuth response detected in URL.</p>
                    <p>Click one of the buttons above to initiate the OAuth process.</p>
                `;
            }
        });
        
        function tryAuth(redirectUri) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Preparing OAuth request...</p>';
            
            const clientId = '01JRZE2B4TMTR46H93MBC012A4';
            const scope = 'channel:read:public';
            const state = 'attempt_' + Date.now();
            
            // Create the simplest possible URL
            const url = `https://kick.com/oauth/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${scope}&state=${state}`;
            
            resultDiv.innerHTML = `
                <p>Opening authorization URL in a new tab:</p>
                <pre>${url}</pre>
                <p style="margin-top: 10px; font-style: italic;">If the new tab doesn't open, check your popup blocker and try again.</p>
            `;
            
            // Open in a new tab
            window.open(url, '_blank');
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    alert('Code copied to clipboard!');
                })
                .catch(err => {
                    alert('Failed to copy: ' + err);
                });
        }
    </script>
</body>
</html> 